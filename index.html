import React, { useState, useEffect } from 'react';
import { Check, Lock, BookOpen } from 'lucide-react';

const MallaCurricular = () => {
  const [completedCourses, setCompletedCourses] = useState(new Set());
  const [totalCredits, setTotalCredits] = useState(0);

  const courses = {
    ciclo1: [
      { code: 'AC4012', name: 'INGLÉS I', credits: 3, prereqs: [] },
      { code: 'EN7011', name: 'PROCESOS BIOLÓGICOS', credits: 6, prereqs: [] },
      { code: 'EN7012', name: 'PRÁCTICAS DE ENFERMERÍA I', credits: 5, prereqs: [] },
      { code: 'AC4011', name: 'DESARROLLO HUMANO Y SOCIAL', credits: 4, prereqs: [] },
      { code: 'TF5012', name: 'ESTRUCTURA Y FUNCIÓN DEL CUERPO HUMANO', credits: 4, prereqs: [] }
    ],
    ciclo2: [
      { code: 'AC4021', name: 'ESTILO DE VIDA, SALUD Y MEDIO AMBIENTE', credits: 4, prereqs: [] },
      { code: 'AC4022', name: 'INGLÉS II', credits: 2, prereqs: ['AC4012'] },
      { code: 'EN7021', name: 'SISTEMA MUSCULOESQUELÉTICO', credits: 3, prereqs: ['TF5012'] },
      { code: 'EN7022', name: 'SISTEMA NERVIOSO Y ENDOCRINO', credits: 5, prereqs: ['TF5012'] },
      { code: 'EN7023', name: 'PRÁCTICAS DE ENFERMERÍA II', credits: 5, prereqs: ['EN7012'] },
      { code: 'ND4021', name: 'MECANISMO DE AGRESIÓN Y DEFENSA I', credits: 4, prereqs: ['EN7011'] }
    ],
    ciclo3: [
      { code: 'EN7031', name: 'SISTEMA CARDIORESPIRATORIO', credits: 5, prereqs: ['EN7021'] },
      { code: 'EN7032', name: 'SISTEMA TEGUMENTARIO', credits: 3, prereqs: ['EN7022'] },
      { code: 'EN7033', name: 'PRÁCTICAS DE ENFERMERÍA III', credits: 5, prereqs: ['EN7023'] },
      { code: 'EN7034', name: 'BASES DE LA TERAPEÚTICA FARMACOLÓGICA', credits: 4, prereqs: [] },
      { code: 'ND4032', name: 'MECANISMOS DE AGRESIÓN Y DEFENSA II', credits: 4, prereqs: ['ND4021'] }
    ],
    ciclo4: [
      { code: 'AC4041', name: 'SALUD PÚBLICA Y SISTEMAS DE SALUD', credits: 5, prereqs: ['AC4021'] },
      { code: 'EN7041', name: 'SISTEMA URINARIO Y REPRODUCTIVO', credits: 4, prereqs: ['EN7031'] },
      { code: 'EN7042', name: 'SISTEMA DIGESTIVO', credits: 4, prereqs: ['EN7032'] },
      { code: 'EN7043', name: 'MECANISMO DE AGRESIÓN Y DEFENSA III', credits: 4, prereqs: ['ND4032'] },
      { code: 'EN7044', name: 'PRÁCTICAS DE ENFERMERÍA IV', credits: 5, prereqs: ['EN7033'] }
    ],
    ciclo5: [
      { code: 'AC4051', name: 'PREVENCIÓN Y PROMOCIÓN DE LA SALUD', credits: 5, prereqs: ['AC4041'] },
      { code: 'EN7051', name: 'SALUD DEL NIÑO Y ADOLESCENTE', credits: 7, prereqs: ['EN7044'] },
      { code: 'EN7052', name: 'SALUD DE LA MUJER Y NEONATO', credits: 7, prereqs: ['EN7044'] },
      { code: 'ELC01', name: 'ELECTIVO I', credits: 3, prereqs: [] }
    ],
    ciclo6: [
      { code: 'AC4061', name: 'CIENCIA Y DESCUBRIMIENTO', credits: 6, prereqs: [] },
      { code: 'EN7061', name: 'GESTIÓN CLÍNICA Y HOSPITALARIA', credits: 4, prereqs: ['EN7051'] },
      { code: 'EN7062', name: 'SALUD DEL ADULTO', credits: 7, prereqs: ['EN7052'] },
      { code: 'ELC02', name: 'ELECTIVO II', credits: 3, prereqs: [] }
    ],
    ciclo7: [
      { code: 'EN7071', name: 'SALUD DEL ADULTO MAYOR', credits: 7, prereqs: ['EN7062'] },
      { code: 'EN7072', name: 'SALUD COMUNITARIA Y FAMILIAR', credits: 5, prereqs: ['EN7061'] },
      { code: 'AC4063', name: 'TENDENCIAS GLOBALES EN SALUD', credits: 3, prereqs: [] },
      { code: 'ELC03', name: 'ELECTIVO III', credits: 3, prereqs: [] }
    ],
    ciclo8: [
      { code: 'EN7082', name: 'SALUD MENTAL', credits: 4, prereqs: ['EN7072'] },
      { code: 'EN7083', name: 'CUIDADOS PALIATIVOS Y DEL FIN DE LA VIDA', credits: 4, prereqs: ['AC4051'] },
      { code: 'EN7084', name: 'URGENCIAS Y EMERGENCIAS', credits: 5, prereqs: ['EN7071'] },
      { code: 'AC4064', name: 'PROYECTOS DE INTERVENCIÓN EN SALUD', credits: 3, prereqs: [] }
    ],
    ciclo9: [
      { code: 'EN7091', name: 'PRÁCTICAS PRE-PROFESIONALES I', credits: 14, prereqs: ['AC4011', 'AC4012', 'AC4021', 'AC4022', 'AC4041', 'AC4051', 'AC4061', 'ELC01', 'ELC02', 'ELC03', 'EN7011', 'EN7012', 'EN7021', 'EN7022', 'EN7023', 'EN7031', 'EN7032', 'EN7033', 'EN7041', 'EN7042', 'EN7043', 'EN7044', 'EN7051', 'EN7052', 'EN7061', 'EN7062', 'EN7071', 'EN7072', 'EN7082', 'EN7083', 'EN7084', 'ND4021', 'ND4032', 'TF5012'] },
      { code: 'EN7092', name: 'SEMINARIOS DE INTEGRACIÓN CLÍNICA I', credits: 1, prereqs: ['AC4064'] },
      { code: 'EN7093', name: 'SEMINARIO DE INVESTIGACIÓN', credits: 3, prereqs: ['AC4061'] }
    ],
    ciclo10: [
      { code: 'EN7101', name: 'PRÁCTICAS PRE-PROFESIONALES II', credits: 14, prereqs: ['EN7091'] },
      { code: 'EN7102', name: 'SEMINARIOS DE INTEGRACIÓN CLÍNICA II', credits: 1, prereqs: ['EN7092'] },
      { code: 'EN7103', name: 'TRABAJO DE INVESTIGACIÓN', credits: 3, prereqs: ['EN7093'] }
    ]
  };

  const electivos = [
    { code: 'AC4E01', name: 'EDUCACIÓN, DERECHOS Y AUTONOMÍA', credits: 3 },
    { code: 'LC5E01', name: 'SALUD AMBIENTAL Y URBANA', credits: 3 },
    { code: 'MH3E01', name: 'DETERMINANTES SOCIALES DE SALUD', credits: 3 },
    { code: 'MH3E02', name: 'ANTROPOLOGÍA MÉDICA', credits: 3 },
    { code: 'ND4E01', name: 'LA DIETA OCCIDENTAL', credits: 3 },
    { code: 'OD5E01', name: 'MÉTODOS DE INVESTIGACIÓN', credits: 3 },
    { code: 'PS4E01', name: 'MANEJO DEL ESTRÉS', credits: 3 },
    { code: 'PS4E02', name: 'FUNDAMENTOS DEL BIENESTAR', credits: 3 },
    { code: 'TF5E01', name: 'IMPACTO DE LA ACTIVIDAD FÍSICA', credits: 3 }
  ];

  const isUnlocked = (course) => {
    if (course.prereqs.length === 0) return true;
    return course.prereqs.every(prereq => completedCourses.has(prereq));
  };

  const toggleCourse = (courseCode, credits) => {
    const newCompleted = new Set(completedCourses);
    if (newCompleted.has(courseCode)) {
      newCompleted.delete(courseCode);
      setTotalCredits(totalCredits - credits);
    } else {
      newCompleted.add(courseCode);
      setTotalCredits(totalCredits + credits);
    }
    setCompletedCourses(newCompleted);
  };

  const CourseCard = ({ course }) => {
    const completed = completedCourses.has(course.code);
    const unlocked = isUnlocked(course);
    
    return (
      <div
        onClick={() => unlocked && toggleCourse(course.code, course.credits)}
        className={`
          relative p-3 rounded-lg border-2 transition-all cursor-pointer
          ${completed ? 'bg-[#9CA896] border-[#7A8A72] text-white' : 
            unlocked ? 'bg-white border-[#C5B4A0] hover:border-[#B5A58F] hover:shadow-md' : 
            'bg-[#E8E3DD] border-[#D4CFC8] opacity-60 cursor-not-allowed'}
        `}
      >
        <div className="flex justify-between items-start mb-1">
          <span className="font-bold text-xs">{course.code}</span>
          <div className="flex items-center gap-1">
            <span className="text-xs bg-[#B8A598] text-white px-2 py-0.5 rounded-full">
              {course.credits} cr
            </span>
            {completed && <Check size={16} className="text-white" />}
            {!unlocked && <Lock size={16} className="text-[#A39B92]" />}
          </div>
        </div>
        <p className="text-xs font-medium leading-tight">{course.name}</p>
        {course.prereqs.length > 0 && (
          <div className="mt-2 text-xs text-[#8B8379]">
            <span className="font-semibold">Req:</span> {course.prereqs.slice(0, 2).join(', ')}
            {course.prereqs.length > 2 && ` +${course.prereqs.length - 2}`}
          </div>
        )}
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-[#F5F2ED] to-[#EAE5DD] p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6 border-2 border-[#D4CFC8]">
          <h1 className="text-3xl font-bold text-[#6B635A] mb-2">
            Malla Curricular - Enfermería
          </h1>
          <p className="text-[#9B9189] mb-4">Universidad Privada Norbert Wiener</p>
          <div className="flex gap-6 items-center flex-wrap">
            <div className="flex items-center gap-2">
              <BookOpen className="text-[#B8A598]" size={24} />
              <div>
                <p className="text-sm text-[#8B8379]">Créditos Completados</p>
                <p className="text-2xl font-bold text-[#7A8A72]">{totalCredits} / 222</p>
              </div>
            </div>
            <div className="flex gap-4 text-xs">
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 bg-[#9CA896] rounded"></div>
                <span className="text-[#6B635A]">Completado</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 bg-white border-2 border-[#C5B4A0] rounded"></div>
                <span className="text-[#6B635A]">Disponible</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 bg-[#E8E3DD] rounded"></div>
                <span className="text-[#6B635A]">Bloqueado</span>
              </div>
            </div>
          </div>
        </div>

        {/* Ciclos */}
        {Object.entries(courses).map(([ciclo, coursesInCiclo], index) => (
          <div key={ciclo} className="mb-6">
            <div className="bg-[#A39B92] text-white px-4 py-2 rounded-t-lg">
              <h2 className="text-lg font-bold">
                {`Ciclo ${index + 1} - Año ${Math.floor(index / 2) + 1} (${index % 2 === 0 ? '1er' : '2do'} Semestre)`}
              </h2>
            </div>
            <div className="bg-white rounded-b-lg p-4 shadow-md border-2 border-[#D4CFC8] border-t-0">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {coursesInCiclo.map(course => (
                  <CourseCard key={course.code} course={course} />
                ))}
              </div>
            </div>
          </div>
        ))}

        {/* Electivos */}
        <div className="mb-6">
          <div className="bg-[#B8A598] text-white px-4 py-2 rounded-t-lg">
            <h2 className="text-lg font-bold">Cursos Electivos (Elegir 3)</h2>
          </div>
          <div className="bg-white rounded-b-lg p-4 shadow-md border-2 border-[#D4CFC8] border-t-0">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              {electivos.map(course => (
                <div
                  key={course.code}
                  onClick={() => toggleCourse(course.code, course.credits)}
                  className={`
                    p-3 rounded-lg border-2 transition-all cursor-pointer
                    ${completedCourses.has(course.code) ? 
                      'bg-[#9CA896] border-[#7A8A72] text-white' : 
                      'bg-white border-[#C5B4A0] hover:border-[#B5A58F] hover:shadow-md'}
                  `}
                >
                  <div className="flex justify-between items-start mb-1">
                    <span className="font-bold text-xs">{course.code}</span>
                    <div className="flex items-center gap-1">
                      <span className="text-xs bg-[#B8A598] text-white px-2 py-0.5 rounded-full">
                        {course.credits} cr
                      </span>
                      {completedCourses.has(course.code) && <Check size={16} className="text-white" />}
                    </div>
                  </div>
                  <p className="text-xs font-medium">{course.name}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default MallaCurricular;
